<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnostic Complete ‚Äî Diagnostic Wizard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="page">
      <section class="card" aria-labelledby="screen-title">
        <div class="eyebrow">Diagnostic Complete</div>
        <p class="route">Route: /diagnostic/results</p>
        <h1 id="screen-title">‚úÖ Diagnostic Complete</h1>
        <p class="helper-text">
          Thank you for completing the diagnostic wizard. Below is a summary of the information collected.
        </p>

        <div id="diagnosticSummary" style="margin-top: 24px;">
          <!-- Diagnostic summary will be displayed here by JavaScript -->
        </div>

        <div style="margin-top: 24px; padding: 16px; background: #f0f9ff; border-radius: 12px; border-left: 3px solid #3b82f6;">
          <p style="font-size: 14px; color: #1e40af; font-weight: 600;">
            üìã Next Steps
          </p>
          <p style="font-size: 14px; color: #1e40af; margin-top: 8px;">
            Based on the diagnostic information collected, recommendations and troubleshooting steps will be provided here.
          </p>
        </div>

        <button class="primary" onclick="window.location.href='index.html'" style="margin-top: 16px;">
          ‚Üê Start New Diagnostic
        </button>
      </section>
    </main>

    <script src="diagnostic-utils.js"></script>
    <script>
      // Display all collected diagnostic parameters
      const params = new URLSearchParams(window.location.search);
      const summaryContainer = document.getElementById('diagnosticSummary');

      if (summaryContainer) {
        const summary = document.createElement('div');
        summary.className = 'diagnostic-info-container';

        const title = document.createElement('h3');
        title.textContent = 'Diagnostic Summary';
        title.className = 'diagnostic-info-title';
        summary.appendChild(title);

        // Group parameters by category
        const categories = {
          'Scope & Target': ['scope', 'target'],
          'Timing Pattern': ['timing', 'intermittent', 'recent_change'],
          'Environment': ['device', 'os', 'connection'],
          'Quick Checks': ['high_latency', 'low_bandwidth', 'dns_issues', 'dns_ms', 'latency_ms', 'ttfb_ms', 'throughput_mbps'],
          'Diagnostic Path': ['diagnostic_path'],
          'Network Diagnostic': ['vpn_issue', 'slowness_scope']
        };

        Object.entries(categories).forEach(([categoryName, keys]) => {
          const categoryParams = keys.filter(key => params.has(key));

          if (categoryParams.length > 0) {
            const categorySection = document.createElement('div');
            categorySection.style.marginTop = '16px';

            const categoryTitle = document.createElement('h4');
            categoryTitle.textContent = categoryName;
            categoryTitle.style.fontSize = '13px';
            categoryTitle.style.fontWeight = '600';
            categoryTitle.style.color = '#475569';
            categoryTitle.style.marginBottom = '8px';
            categorySection.appendChild(categoryTitle);

            const paramsList = document.createElement('ul');
            paramsList.className = 'diagnostic-params-list';

            categoryParams.forEach(key => {
              const value = params.get(key);
              const li = document.createElement('li');

              // Format the key for display
              const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

              // Format boolean values
              let displayValue = value;
              if (value === 'true') displayValue = 'Yes';
              if (value === 'false') displayValue = 'No';

              li.innerHTML = `<strong>${formattedKey}:</strong> ${displayValue}`;
              paramsList.appendChild(li);
            });

            categorySection.appendChild(paramsList);
            summary.appendChild(categorySection);
          }
        });

        summaryContainer.appendChild(summary);
      }
    </script>
  </body>
</html>
